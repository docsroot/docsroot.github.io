<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />

    <title>SQL Server - working with a custom role</title>

    <meta name="twitter:title" property="og:title" content="SQL Server - working with a custom role">
    <meta name="twitter:description" property="og:description">
    <meta property="og:url" content="https://docsroot.github.io/SQL-Server---working-with-a-custom-role.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="DocsRoot">

    <meta name="author" content="hu****hd@gmail.com" />
    <meta name="creator" content="docsroot" />

    <style type="text/css">
        blockquote {
            border-left: 5px solid green;
            margin: 10px;
            padding: 10px;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: #DDD;
            text-align: center;
            height: 22px;
            line-height: 22px;
        }
    </style>
</head>
<body>
    <!--Heading of the page-->
    <h1>SQL Server - working with a custom role</h1>

    

    <!--The body part: what you put into RTE-->
    <p>Following this task we will create a custom role named ReadAndExecute1 and assign it to a sql account, a windows account and a windows group.</p><p>The database will have one table, two stored procedures.</p><p>1/ Script to create database with sprocs:</p><blockquote>create database RoleTest1<br>go<br>use RoleTest1<br>go<br>create table [Users] (<br><span style="white-space:pre">	</span>Id int identity (1,1) primary key,<br><span style="white-space:pre">	</span>FullName nvarchar(250) not null<br>)<br>go<br>create proc GetAllUsers<br>as<br>begin<br><span style="white-space:pre">	</span>select * from [Users]<br><span style="white-space:pre">	</span>order by FullName<br>end<br>go<br>create proc SearchUsers(<br><span style="white-space:pre">	</span>@fullName nvarchar(250)<br>)<br>as<br>begin<br><span style="white-space:pre">	</span>select * from [Users]<br><span style="white-space:pre">	</span>where FullName like '%' + @fullName + '%'<br><span style="white-space:pre">	</span>order by FullName<br>end<br>go</blockquote><p>2. Create a global login, then create a user for the database&nbsp;RoleTest1</p><blockquote><p>create login SqUser1 with password = '&lt;PWD&gt;'<br>go<br>use RoleTest1<br>go<br>create user SqUser1 for login SqUser1</p><p>WITH DEFAULT_SCHEMA = dbo</p><p>-- if not having a default schema, sql server will create one for the user<br>go</p></blockquote><p>3. Create a role, add member and grant permissions for the role</p><blockquote><p>CREATE ROLE [ReadAndExecute1]&nbsp;<br>GO<br>EXEC sp_addrolemember [ReadAndExecute1], [SqUser1]<br>go<br>grant execute on object::dbo.GetAllUsers to [ReadAndExecute1]<br>go</p><p>grant VIEW DEFINITION on object::dbo.GetAllUsers to [ReadAndExecute1]<br>go</p></blockquote><p>4. Script to create a Windows login</p><blockquote>create login [p5vn-pc044\huan] from windows<br>go<br>use [RoleTest1]<br>go<br>create user [p5vn-pc044\huan] for login [p5vn-pc044\huan]<br>go<br>EXEC sp_addrolemember [ReadAndExecute1], [p5vn-pc044\huan]<br>go</blockquote><div>5. Windows group login</div><div>Now we can add the member to Windows group, then remove the user from role&nbsp;[ReadAndExecute1], add the group to role</div><div><br></div><div><blockquote>drop user [&lt;server&gt;\&lt;user&gt;]&nbsp;<br>go<br>create login [&lt;server&gt;\&lt;group&gt;] from windows<br>go<br>use [RoleTest1]<br>go<br>create user [&lt;server&gt;\&lt;group&gt;] for login [&lt;server&gt;\&lt;group&gt;]<br>go<br>EXEC sp_addrolemember [ReadAndExecute1], [&lt;server&gt;\&lt;group&gt;]<br>go</blockquote><div><br></div></div><p><b>References:</b></p><ul><li><a href="https://docs.microsoft.com/en-us/sql/t-sql/statements/create-user-transact-sql?view=sql-server-2017" target="_blank">CREATE USER (Transact-SQL)</a></li><li><a href="https://docs.microsoft.com/en-us/sql/relational-databases/stored-procedures/grant-permissions-on-a-stored-procedure?view=sql-server-2017" target="_blank">Grant Permissions on a Stored Procedure</a><br><br></li></ul>

    

    <footer>
        By <a href="http://docsroot.devcovery.com/Listing/ViewBy?author=1" target="_blank">hu****hd@gmail.com</a> at 1/31/2019 8:20:38 AM. <a href="https://docsroot.github.io/SQL-Server---working-with-a-custom-role.html" target="_blank">View online</a>. Built with &hearts; by <a href="http://docsroot.devcovery.com" target="_blank">docsroot</a>
    </footer>
</body>
</html>
